!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.AudioFeeder=e():t.AudioFeeder=e()}(self,()=>{return i={369:t=>{window,t.exports=function(){return r=[function(t,e){t.exports={float_array:function(t){return new Float32Array(t)},blit:function(t,e,r,i,o){r.set(t.subarray(e,e+o),i)}}},function(t,e,r){var tt=r(0),a=r(2);t.exports=function(t){for(var v=(t=t||{}).sampleRate||44100,e=t.wsizeLog||11,y=t.tempo||1,V=(t.numChannels,Math.pow(2,50/1200)-1),C=1<<e,g=a(e),r=1<<e-2,k=tt.float_array(C+(r-=r%100)+5),w=tt.float_array(C+r+5),z=r,S=r,P=tt.float_array(C),i=0;i<C;i++)P[i]=.5*(1-Math.cos(2*Math.PI*i/C));for(var B=1+(C>>1),T=tt.float_array(B),M=tt.float_array(B),x=tt.float_array(B),A=tt.float_array(B),W=tt.float_array(B),X=tt.float_array(B),o=1+(B>>1),Q=[0,0],j=[],F=[],O=[],R=[],i=0;i<2;i++)j.push(tt.float_array(o)),F.push(tt.float_array(o)),O.push(tt.float_array(o)),R.push(tt.float_array(B));function N(t,e,r){var i=(r=Math.floor(r))%2==1?-1:1;return Math.atan2(i*(e[r]-e[r+1]),i*(t[r]-t[r+1]))}var D=tt.float_array(o),L=tt.float_array(o),I=0,E=0,n=[{in_time:0,out_time:0,tempo:y}],J=0,U=0,Y=1,q=0,Z=0,G=0,H=0,K={mapOutputToInputTime:function(t){for(var e=n.length-1;t<n[e].out_time&&0<e;)e--;var r=n[e];return r.in_time+r.tempo*(t-r.out_time)},flush:function(t){Q=[q=0,0];for(var e=G=H=U=0;e<2;e++)for(var r=0;r<B;r++)R[e][r]=0;for(e=0;e<k.length;e++)k[e]=0;for(e=0;e<w.length;e++)w[e]=0;if(t){E=Math.max(0,E-t),I=K.mapOutputToInputTime(E);for(var i=n.length-1;E<=n[i].out_time&&0<=i;)n.pop(),i--;n.push({in_time:I,out_time:E,tempo:y})}},getTempo:function(){return y},setTempo:function(t){z=S=r,1<=t?S=Math.round(z/t):z=Math.round(S*t),Z=(1/t-+S/z)*z,Y=function(t,e){for(var r=t.length/e|0,i=0,o=0;o<r;o++)i+=t[o*e];return.9/i}(P,S),y=t;var e=n[n.length-1];e.out_time==E?e.tempo=t:n.push({in_time:I,out_time:E,tempo:t})}},$=(K.flush(0),K.setTempo(y),function(t,e,r,i,o,n){for(var a=t%2,f=1-a,u=R[f],s=Q[f],h=j[f],p=F[f],l=O[f],c=R[a],d=1;d<c.length;d++)c[d]=e[d]*e[d]+r[d]*r[d];var _=j[a],m=Q[a]=function(t,e){for(var r=0,i=0;i<t.length;i++)t[i]>r&&(r=t[i]);var o,n=1e-8*r,a=1,f=1;for(e[0]=1,i=2;i<t.length;i++)t[i]>n&&t[i]>t[i-1]&&t[i]>=t[i+1]&&((o=i+(t[i-1]-t[i+1])/(2*(t[i-1]-2*t[i]+t[i+1])))-e[a-1]>i*V?(e[a++]=o,f=i):t[i]>t[f]&&(e[a-1]=o,f=i));return a}(c,_),b=F[a],v=O[a];if(0!=t&&0!=m){for(var y=0,g=0;g<m;g++){for(I=_[g];_[g]>h[y]&&y!=s;)++y;var k,w=y,S=(0<y&&I-h[y-1]<h[y]-I&&(w=y-1),I*V);Math.abs(h[w]-I)<S&&u[Math.round(h[w])]>.1*c[Math.round(I)]?(S=N(e,r,I),k=p[w]+l[w]+function(t,e,r,i,o){i=2*Math.PI/C*.5*(i+e)*z;return((e=t-r-i)-2*Math.PI*Math.round(e/(2*Math.PI))+i)*o}(S,I,p[w],h[w],n)-S,b[g]=S,v[g]=k,D[g]=Math.cos(k),L[g]=Math.sin(k)):(b[g]=N(e,r,I),v[g]=0,D[g]=1,L[g]=0)}_[m]=2*C;for(var P=_[w=0],B=_[w+1],T=D[w],M=L[w],d=1;d<e.length-1;d++){P<=d&&B-d<d-P&&(P=_[++w],B=_[w+1],T=D[w],M=L[w]);var x=e[d]*T-r[d]*M,A=e[d]*M+r[d]*T;e[d]=x,r[d]=A}}else for(var g=0;g<m;g++){var I=_[g];p[g]=l[g]=N(e,r,I)}});return K.process=function(t){var e=t[0].length,r=t[0];if(1<t.length)for(var r=tt.float_array(t[0].length),i=1/t.length,o=0;o<t.length;o++)for(var n=0;n<e;n++)r[n]+=i*t[o][n];if(1==y){if(0<H+G){for(var a=H+G+e,f=[],o=0;o<t.length;o++){var u=tt.float_array(a);tt.blit(w,0,u,0,H),tt.blit(k,0,u,H,G),tt.blit(t[o],0,u,H+G,e),f.push(u)}K.flush(0),e=a,t=f}return I+=e/v,E+=e/v,t}var s=G+e-(C-z),s=2*Math.floor(Math.max(0,s)/(2*z)),h=H+S*s+Math.floor(q+Z*s),p=(h<H&&(h=H),tt.float_array(h));tt.blit(w,0,p,0,H);for(var l=0,c=H,d=0,_=0;;){var m=C+z-G;if(e<l+m){tt.blit(r,l,k,G,e-l),G+=e-l,l=e;break}m<=0?G-=2*z:(tt.blit(r,l,k,G,m),l+=m,G=C-z),_=function(){var t=0|(q+=2*Z);q-=t;for(var e=0;e<C;e++)g.m_re[e]=P[e]*k[e],g.m_im[e]=P[e]*k[z+e];tt.blit(k,2*z,k,0,C-z),g.inplace(!1),g.unpack(T,M,x,A),$(J,T,M,0,0,+S/z),$(J+1,x,A,0,0,+(S+t)/z),tt.blit(x,0,W,0,B),tt.blit(A,0,X,0,B),g.repack(T,M,x,A),g.inplace(!0);var r=w.length;for(tt.blit(w,U,w,0,r-U),e=r-U;e<r;e++)w[e]=0;for(var i=0,o=Y,e=0;e<S;e++)Math.abs(2*g.m_re[e])>i&&(i=Math.abs(2*g.m_re[e]));for(e=0;e<C-S;e++)Math.abs(g.m_re[e+S+t]+g.m_im[e])>i&&(i=Math.abs(g.m_re[e+S+t]+g.m_im[e]));for(e=C-S;e<C;e++)Math.abs(2*g.m_im[e])>i&&(i=Math.abs(2*g.m_im[e]));var n=1/Math.floor(+C/(2*S));for(n<o*i&&(o=n/i),e=0;e<C;e++)w[e]+=o*g.m_re[e],w[e+S+t]+=o*g.m_im[e];return J+=2,U=2*S+t}(),I+=2*z/v,E+=_/v,(d=c+_-h)<0&&(d=0),tt.blit(w,0,p,c,_-d),c+=_}tt.blit(w,_-d,w,0,d),H=d;var b=[];for(o=0;o<t.length;o++)b.push(p);return b},K}},function(t,e,r){"use strict";var h=r(0);t.exports=function(t){for(var n=1<<t,M={m_logN:t,m_N:n,m_invN:1/n,m_re:h.float_array(n),m_im:h.float_array(n),m_revTgt:new Array(n)},e=0;e<n;e++){for(var r=e,i=0,o=0;o<t;o++)i=i<<1|1&r,r>>=1;M.m_revTgt[e]=i}M.twiddleRe=h.float_array(M.m_logN),M.twiddleIm=h.float_array(M.m_logN);for(var a=1,f=0;f<M.m_logN;f++){var u=2*a*Math.PI*M.m_invN;M.twiddleRe[f]=Math.cos(u),M.twiddleIm[f]=Math.sin(u),a<<=1}M.inplace=function(t){var e=M.m_re,r=M.m_im,i=M.m_N,o=M.m_logN,n=i>>1,a=i>>1,f=i;if(t)for(var u=1/i,s=0;s<i;s++)e[s]*=u,r[s]*=u;for(var h=0;h<o;h++){var p=M.twiddleRe[h],l=M.twiddleIm[h];t||(l*=-1);for(var c=0;c<i;){for(var d=c,_=c+a,m=1,b=0,v=0;v<n;v++)var y=e[d],g=r[d],k=e[_],w=r[_],y=(e[d]=y+k,r[d]=g+w,e[_]=(k=y-k)*m-(w=g-w)*b,r[_]=k*b+w*m,d++,_++,m),m=m*p-b*l,b=y*l+b*p;c+=f}n>>=1,a>>=1,f>>=1}for(var S,P,B=M.m_revTgt,T=0;T<i;T++)B[T]>T&&(P=e[S=B[T]],e[S]=e[T],e[T]=P,P=r[S],r[S]=r[T],r[T]=P)};var s=n>>1;return M.unpack=function(t,e,r,i){t[0]=M.m_re[0],r[0]=M.m_im[0],e[0]=i[0]=0,t[s]=M.m_re[s],r[s]=M.m_im[s],e[s]=i[s]=0;for(var o=1;o<s;o++)t[o]=(M.m_re[o]+M.m_re[n-o])/2,e[o]=(M.m_im[o]-M.m_im[n-o])/2,r[o]=(M.m_im[o]+M.m_im[n-o])/2,i[o]=(-M.m_re[o]+M.m_re[n-o])/2},M.repack=function(t,e,r,i){M.m_re[0]=t[0],M.m_im[0]=r[0],M.m_re[s]=t[s],M.m_im[s]=r[s];for(var o=1;o<s;o++)M.m_re[o]=t[o]-i[o],M.m_im[o]=e[o]+r[o],M.m_re[n-o]=t[o]+i[o],M.m_im[n-o]=-e[o]+r[o]},M}}],i={},o.m=r,o.c=i,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(r,i,function(t){return e[t]}.bind(null,i));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=1);function o(t){var e;return(i[t]||(e=i[t]={i:t,l:!1,exports:{}},r[t].call(e.exports,e,e.exports,o),e.l=!0,e)).exports}var r,i}()},381:t=>{function e(t,e){if(t<1||t!==Math.round(t))throw"Invalid channel count for BufferQueue";this.channels=t,this.bufferSize=e,this.flush()}e.prototype.flush=function(){this._buffers=[],this._pendingBuffer=this.createBuffer(this.bufferSize),this._pendingPos=0},e.prototype.sampleCount=function(){var e=0;return this._buffers.forEach(function(t){e+=t[0].length}),e},e.prototype.createBuffer=function(t){for(var e=[],r=0;r<this.channels;r++)e[r]=new Float32Array(t);return e},e.prototype.validate=function(t){if(t.length!==this.channels)return!1;for(var e,r=0;r<t.length;r++){var i=t[r];if(!(i instanceof Float32Array))return!1;if(0==r)e=i.length;else if(i.length!==e)return!1}return!0},e.prototype.appendBuffer=function(t){if(!this.validate(t))throw"Invalid audio buffer passed to BufferQueue.appendBuffer";for(var e=t[0].length,r=this.channels,i=this._pendingPos,o=this._pendingBuffer,n=this.bufferSize,a=0;a<e;a++){for(var f=0;f<r;f++)o[f][i]=t[f][a];++i==n&&(this._buffers.push(o),i=this._pendingPos=0,o=this._pendingBuffer=this.createBuffer(n))}this._pendingPos=i},e.prototype.prependBuffer=function(t){if(!this.validate(t))throw"Invalid audio buffer passed to BufferQueue.prependBuffer";var e=this._buffers.slice(0);e.push(this.trimBuffer(this._pendingBuffer,0,this._pendingPos)),this.flush(),this.appendBuffer(t);for(var r=0;r<e.length;r++)this.appendBuffer(e[r])},e.prototype.nextBuffer=function(){var t;return this._buffers.length?this._buffers.shift():(t=this.trimBuffer(this._pendingBuffer,0,this._pendingPos),this._pendingBuffer=this.createBuffer(this.bufferSize),this._pendingPos=0,t)},e.prototype.trimBuffer=function(t,e,r){var i=t[0].length,o=e+Math.min(r,i);if(0==e&&i<=o)return t;for(var n=[],a=0;a<this.channels;a++)n[a]=t[a].subarray(e,o);return n},t.exports=e},138:(t,e,r)=>{function i(t){this._options=t||{},this._backend=null,this._resampleFractional=0,this._resampleLastSampleData=void 0,this._tempoChanger=null}var o,n;r(381),o=r(863),n=r(369),i.prototype.rate=0,i.prototype.targetRate=0,i.prototype.channels=0,i.prototype.bufferSize=0,Object.defineProperty(i.prototype,"bufferDuration",{get:function(){return this.targetRate?this.bufferSize/this.targetRate:0}}),Object.defineProperty(i.prototype,"bufferThreshold",{get:function(){return this._backend?this._backend.bufferThreshold/this.targetRate:0},set:function(t){if(!this._backend)throw"Invalid state: AudioFeeder cannot set bufferThreshold before init";this._backend.bufferThreshold=Math.round(t*this.targetRate)}}),Object.defineProperty(i.prototype,"playbackPosition",{get:function(){return this._backend?this.getPlaybackState().playbackPosition:0}}),Object.defineProperty(i.prototype,"outputPlaybackPosition",{get:function(){return this._backend?this.getPlaybackState().outputPlaybackPosition:0}}),Object.defineProperty(i.prototype,"durationBuffered",{get:function(){return this._backend?this.getPlaybackState().samplesQueued/this.targetRate:0}}),Object.defineProperty(i.prototype,"muted",{get:function(){if(this._backend)return this._backend.muted;throw"Invalid state: cannot get mute before init"},set:function(t){if(!this._backend)throw"Invalid state: cannot set mute before init";this._backend.muted=t}}),i.prototype.mute=function(){this.muted=!0},i.prototype.unmute=function(){this.muted=!1},Object.defineProperty(i.prototype,"volume",{get:function(){if(this._backend)return this._backend.volume;throw"Invalid state: cannot get volume before init"},set:function(t){if(!this._backend)throw"Invalid state: cannot set volume before init";this._backend.volume=t}}),Object.defineProperty(i.prototype,"tempo",{get:function(){if(this._tempoChanger)return this._tempoChanger.getTempo();throw"Invalid state: cannot get tempo before init"},set:function(t){if(!this._tempoChanger)throw"Invalid state: cannot set tempo before init";this._tempoChanger.setTempo(t)}}),i.prototype.init=function(t,e){if(this.channels=t,this.rate=e,this._options.backendFactory)this._backend=this._options.backendFactory(t,e,this._options);else{if(!o.isSupported())throw"No supported backend";this._backend=new o(t,e,this._options)}this.targetRate=this._backend.rate,this.bufferSize=this._backend.bufferSize,this._tempoChanger=n({sampleRate:this.targetRate,numChannels:t,tempo:1}),this._backend.onstarved=function(){this.onstarved&&this.onstarved()}.bind(this),this._backend.onbufferlow=function(){this.onbufferlow&&this.onbufferlow()}.bind(this)},i.prototype._resample=function(t){var s=this.rate,e=this.channels,h=this._backend.rate,r=this._backend.channels;if(s==h&&e==r)return t;var i=[],o=t[0].length,p=this._resampleFractional,o=o*h/s+p,n=Math.floor(o),o=o-n,a=s<h?function(e,t,r,i){function o(t){return t<0?r&&0<r.length+t?r[r.length+t]:e[0]:e[t]}for(var n=0;n<t.length;n++){var a=(n+1-p)*s/h-1,f=Math.floor(a),u=Math.ceil(a),u=f==u?o(f):o(f)*(u-a)+o(u)*(a-f);t[n]=i*u}}:function(t,e,r,i){for(var o=0;o<e.length;o++)e[o]=i*t[o*t.length/e.length|0]},f=1;e<r&&(f=Math.SQRT1_2);for(var u=0;u<r;u++){var l=u,c=t[l=e<=u?0:u],d=new Float32Array(n);a(c,d,this._resampleLastSampleData?this._resampleLastSampleData[l]:void 0,f),i.push(d)}return this._resampleFractional=o,this._resampleLastSampleData=t,i},i.prototype.bufferData=function(t){if(!this._backend)throw"Invalid state: AudioFeeder cannot bufferData before init";t=this._resample(t),t=this._tempoChanger.process(t);this._backend.appendBuffer(t)},i.prototype.getPlaybackState=function(){var t;if(this._backend)return(t=this._backend.getPlaybackState()).outputPlaybackPosition=t.playbackPosition,t.playbackPosition=this._tempoChanger.mapOutputToInputTime(t.outputPlaybackPosition),t;throw"Invalid state: AudioFeeder cannot getPlaybackState before init"},i.prototype.waitUntilReady=function(t){if(!this._backend)throw"Invalid state: AudioFeeder cannot waitUntilReady before init";this._backend.waitUntilReady(t)},i.prototype.start=function(){if(!this._backend)throw"Invalid state: AudioFeeder cannot start before init";this._backend.start()},i.prototype.stop=function(){if(!this._backend)throw"Invalid state: AudioFeeder cannot stop before init";this._backend.stop()},i.prototype.flush=function(){if(this._resampleFractional=0,this._resampleLastSampleData=void 0,!this._backend)throw"Invalid state: AudioFeeder cannot flush before init";this._tempoChanger.flush(this.durationBuffered),this._backend.flush()},i.prototype.close=function(){this._backend&&(this._backend.close(),this._backend=null)},i.prototype.onstarved=null,i.prototype.onbufferlow=null,i.isSupported=function(){return!!Float32Array&&o.isSupported()},i.initSharedAudioContext=function(){return o.isSupported()?o.initSharedAudioContext():null},t.exports=i},609:t=>{var e;t.exports=void 0!==window.setImmediate?window.setImmediate:window&&window.postMessage?(e=[],window.addEventListener("message",function(t){t.source===window&&"object"==typeof(t=t.data)&&t.nextTickBrowserPingMessage&&(t=e.pop())&&t()}),function(t){e.push(t),window.postMessage({nextTickBrowserPingMessage:!0},document.location.toString())}):function(t){setTimeout(t,0)}},863:(t,e,r)=>{function o(t,e,r){var i=r.audioContext||o.initSharedAudioContext();if(this._context=i,this.output=r.output||i.destination,this.rate=i.sampleRate,this.channels=2,r.bufferSize&&(this.bufferSize=0|r.bufferSize),this.bufferThreshold=2*this.bufferSize,this._bufferQueue=new n(this.channels,this.bufferSize),this._playbackTimeAtBufferTail=i.currentTime,this._queuedTime=0,this._delayedTime=0,this._dropped=0,this._liveBuffer=this._bufferQueue.createBuffer(this.bufferSize),i.createScriptProcessor)this._node=i.createScriptProcessor(this.bufferSize,0,this.channels);else{if(!i.createJavaScriptNode)throw new Error("Bad version of web audio API?");this._node=i.createJavaScriptNode(this.bufferSize,0,this.channels)}}var i,n,s;i=window.AudioContext||window.webkitAudioContext,n=r(381),s=r(609),o.prototype.bufferSize=4096,o.prototype.bufferThreshold=8192,o.prototype._volume=1,Object.defineProperty(o.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=+t}}),o.prototype._muted=!1,Object.defineProperty(o.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted=!!t}}),o.prototype._audioProcess=function(t){var e,r,i,o,n="number"==typeof t.playbackTime?t.playbackTime:this._context.currentTime+this.bufferSize/this.rate,a=this._playbackTimeAtBufferTail;if(a<n&&(this._delayedTime+=n-a),this._bufferQueue.sampleCount()<this.bufferSize&&this.onstarved&&this.onstarved(),this._bufferQueue.sampleCount()<this.bufferSize){for(e=0;e<this.channels;e++)for(i=t.outputBuffer.getChannelData(e),o=0;o<this.bufferSize;o++)i[o]=0;this._dropped++}else{var f=this.muted?0:this.volume,u=this._bufferQueue.nextBuffer();if(u[0].length<this.bufferSize)throw"Audio buffer not expected length.";for(e=0;e<this.channels;e++)for(r=u[e],this._liveBuffer[e].set(u[e]),i=t.outputBuffer.getChannelData(e),o=0;o<r.length;o++)i[o]=r[o]*f;this._queuedTime+=this.bufferSize/this.rate,this._playbackTimeAtBufferTail=n+this.bufferSize/this.rate,this._bufferQueue.sampleCount()<Math.max(this.bufferSize,this.bufferThreshold)&&this.onbufferlow&&s(this.onbufferlow.bind(this))}},o.prototype._samplesQueued=function(){return this._bufferQueue.sampleCount()+Math.floor(this._timeAwaitingPlayback()*this.rate)},o.prototype._timeAwaitingPlayback=function(){return Math.max(0,this._playbackTimeAtBufferTail-this._context.currentTime)},o.prototype.getPlaybackState=function(){return{playbackPosition:this._queuedTime-this._timeAwaitingPlayback(),samplesQueued:this._samplesQueued(),dropped:this._dropped,delayed:this._delayedTime}},o.prototype.waitUntilReady=function(t){t()},o.prototype.appendBuffer=function(t){this._bufferQueue.appendBuffer(t)},o.prototype.start=function(){this._node.onaudioprocess=this._audioProcess.bind(this),this._node.connect(this.output),this._playbackTimeAtBufferTail=this._context.currentTime},o.prototype.stop=function(){var t,e,r;this._node&&(0<(t=this._timeAwaitingPlayback())&&(e=Math.round(t*this.rate),(r=this._liveBuffer?this._liveBuffer[0].length:0)<e?(this._bufferQueue.prependBuffer(this._liveBuffer),this._bufferQueue.prependBuffer(this._bufferQueue.createBuffer(e-r))):this._bufferQueue.prependBuffer(this._bufferQueue.trimBuffer(this._liveBuffer,r-e,e)),this._playbackTimeAtBufferTail-=t),this._node.onaudioprocess=null,this._node.disconnect())},o.prototype.flush=function(){this._bufferQueue.flush()},o.prototype.close=function(){this.stop(),this._context=null},o.prototype.onstarved=null,o.prototype.onbufferlow=null,o.isSupported=function(){return!!i},o.sharedAudioContext=null,o.initSharedAudioContext=function(){if(!o.sharedAudioContext&&o.isSupported()){var t,e=new i;if(e.createScriptProcessor)t=e.createScriptProcessor(1024,0,2);else{if(!e.createJavaScriptNode)throw new Error("Bad version of web audio API?");t=e.createJavaScriptNode(1024,0,2)}t.connect(e.destination),t.disconnect(),o.sharedAudioContext=e}return o.sharedAudioContext},t.exports=o}},o={},function t(e){var r=o[e];return void 0!==r||(r=o[e]={exports:{}},i[e](r,r.exports,t)),r.exports}(138);var i,o});